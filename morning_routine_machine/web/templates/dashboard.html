<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Morning Routine Machine Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Link to your CSS file -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="page">
        <!-- Top bar -->
        <header class="topbar">
            <div class="topbar-left">
                <h1 class="app-title">Morning Routine Machine</h1>
                <p class="app-subtitle">Light, Motion, &amp; Blinds Automation</p>
            </div>
            <div class="topbar-right">
                <span class="pill pill-green">Online</span>
            </div>
        </header>

        {% set latest = logs[0] if logs else None %}

        <!-- Main content -->
        <main class="main">
            <!-- Summary cards -->
            <section class="cards">
                <div class="card">
                    <h2 class="card-title">Current Temperature</h2>
                    {% if latest %}
                        <p class="card-value">
                            {{ "%.1f"|format(latest.temperature_f) }}&deg;F
                            <span class="muted">/ {{ "%.1f"|format(latest.temperature_c) }}&deg;C</span>
                        </p>
                    {% else %}
                        <p class="card-value muted">No data yet</p>
                    {% endif %}
                </div>

                <div class="card">
                    <h2 class="card-title">Humidity</h2>
                    {% if latest %}
                        <p class="card-value">
                            {{ "%.0f"|format(latest.humidity) }}%
                        </p>
                    {% else %}
                        <p class="card-value muted">No data yet</p>
                    {% endif %}
                </div>

                <div class="card">
                    <h2 class="card-title">Light Status</h2>
                    {% if latest %}
                        {% if latest.light %}
                            <p class="card-value">
                                <span class="pill pill-yellow">Light Detected</span>
                            </p>
                        {% else %}
                            <p class="card-value">
                                <span class="pill pill-dark">Dark</span>
                            </p>
                        {% endif %}
                    {% else %}
                        <p class="card-value muted">No data yet</p>
                    {% endif %}
                </div>

                <div class="card">
                    <h2 class="card-title">Last Motion</h2>
                    {% if latest %}
                        {% if latest.motion %}
                            <p class="card-value pill pill-purple">Motion in last event</p>
                        {% else %}
                            <p class="card-value muted">No motion in last event</p>
                        {% endif %}
                        <p class="card-footer">
							{% if latest.az_time %}
								{{ latest.az_time.strftime("%Y-%m-%d %H:%M:%S") }}
							{% else %}
								-
							{% endif %}
                            
                        </p>
                    {% else %}
                        <p class="card-value muted">No events yet</p>
                    {% endif %}
                </div>
            </section>

            <!-- Rules panel -->
            <section class="rules">
    <h2 class="section-title">Automation Rules</h2>
    <ul class="rules-list">
        <li>
            <span class="rule-label">RULE 1</span>
            <span class="rule-text">
                First activation:
                <strong>
                    {% if config.first_activation_mode == "light" %}
                        First light → OPEN blinds (3 turns)
                    {% else %}
                        At {{ config.first_activation_time }} → OPEN blinds (3 turns)
                    {% endif %}
                </strong>
            </span>
        </li>
        <li>
            <span class="rule-label">RULE 2</span>
            <span class="rule-text">
                After that → Motion <strong>toggles OPEN / CLOSE</strong>
            </span>
        </li>
    </ul>

    <form action="{{ url_for('update_settings') }}" method="post" class="settings-form">
        <h3 class="section-title" style="margin-top: 0.75rem;">First Activation Settings</h3>

        <div class="settings-row">
            <label class="settings-option">
                <input type="radio" name="activation_mode" value="light"
                       {% if config.first_activation_mode == "light" %}checked{% endif %}>
                <span>Use first <strong>light detection</strong></span>
            </label>
        </div>

        <div class="settings-row">
            <label class="settings-option">
                <input type="radio" name="activation_mode" value="time"
                       {% if config.first_activation_mode == "time" %}checked{% endif %}>
                <span>Use a specific <strong>time</strong></span>
            </label>
            <div class="settings-time">
                <label>
                    Time:
                    <input type="time"
                           name="activation_time"
                           value="{{ config.first_activation_time }}">
                </label>
            </div>
        </div>

        <button type="submit" class="btn">Save Settings</button>
    </form>
</section>


            <!-- Log table -->
            <section class="logs">
                <div class="logs-header">
                    <h2 class="section-title">Recent Sensor Log</h2>
                    <p class="section-subtitle">
                        Showing up to the last 50 events
                    </p>
                </div>

                {% if logs %}
                    <div class="table-wrapper">
                        <table class="log-table">
                            <thead>
                                <tr>
                                    <th>Time (Local)</th>
                                    <th>Temp (&deg;F)</th>
                                    <th>Temp (&deg;C)</th>
                                    <th>Humidity (%)</th>
                                    <th>Light</th>
                                    <th>Motion</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in logs %}
                                    <tr>
                                        <td>{{ row.az_time.strftime("%Y-%m-%d %H:%M:%S") }}</td>
                                        <td>{{ "%.1f"|format(row.temperature_f) if row.temperature_f is not none else "-" }}</td>
                                        <td>{{ "%.1f"|format(row.temperature_c) if row.temperature_c is not none else "-" }}</td>
                                        <td>{{ "%.0f"|format(row.humidity) if row.humidity is not none else "-" }}</td>
                                        <td>
                                            {% if row.light %}
                                                <span class="pill pill-yellow pill-small">Light</span>
                                            {% else %}
                                                <span class="pill pill-dark pill-small">Dark</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if row.motion %}
                                                <span class="pill pill-purple pill-small">Motion</span>
                                            {% else %}
                                                <span class="pill pill-grey pill-small">No Motion</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="empty-state">
                        No sensor data has been logged yet. Once the automation runs,
                        readings will appear here.
                    </p>
                {% endif %}
            </section>
        </main>

        <footer class="footer">
            <p>Morning Routine Machine &mdash; Raspberry Pi Automation Project</p>
        </footer>
    </div>
</body>
</html>
